<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electron App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<a href="lab2.html">Lab2</a>
<h1>Lab1</h1>
<form id="form">
    <label for="startSymbol">Start Symbol:</label>
    <input type="text" name="startSymbol" id="startSymbol" value="A">
    <br>
    <label for="minLen">Min Length:</label>
    <input type="number" name="minLen" id="minLen" value="4">
    <br>
    <label for="maxLen">Max Length:</label>
    <input type="number" name="maxLen" id="maxLen" value="10">
    <br>
    <label for="nonTerminals" id="nonTerminals-label">Non-Terminal Symbols:</label>
    <input type="text" name="nonTerminals" id="nonTerminals" placeholder="A B C" value="A">
    <br>
    <label for="terminals" id="terminals-label">Terminal Symbols:</label>
    <input type="text" name="terminals" id="terminals" placeholder="a b c" value="0 1">
    <br>
    <label for="rule" id="rules-label">Rules:</label>
    <div id="rules-container"></div>
    <div class="add-rule-container">
        <input type="text" name="rule" id="rule" class="add-rule-input"
               placeholder="nonTerminal -> production1 | production2 | ..."
               value="A -> 01A | 10A | 00 | 11">
        <button type="button" id="add-rule" class="btn add-rule-btn">+</button>
    </div>
    <br>
    <div class="main-btns">
        <button type="submit" id="generate" class="btn">Generate All Chains</button>
        <button type="button" id="clear" class="btn">Clear</button>
    </div>
    <select id="chain-select" style="display:none"></select>
    <button id="build-tree" style="display:none">Build Tree</button>
    <p id="result"></p>
</form>

<script src="Grammar.js"></script>
<script>
  let rules = [];

  document.getElementById('add-rule').addEventListener('click', (e) => {
    const rule = document.getElementById('rule').value;
    if (rule) {
      rules.push(rule);
      document.getElementById('rules-container').innerHTML += `<p class="rule-item">${rule}</p>`;
      document.getElementById('rule').value = '';
    }
  });

  document.getElementById('clear').addEventListener('click', (e) => {
    document.getElementById('rules-container').innerHTML = '';
    document.getElementById('result').textContent = ``;
    document.getElementById('chain-select').style.display = 'none';
    document.getElementById('build-tree').style.display = 'none';
    rules = [];
  });

  document.getElementById('generate').addEventListener('click', (e) => {
    e.preventDefault();
    document.getElementById('result').textContent = ``;
    const startSymbol = document.getElementById('startSymbol').value;
    const minLen = parseInt(document.getElementById('minLen').value);
    const maxLen = parseInt(document.getElementById('maxLen').value);
    const nonTerminals = document.getElementById('nonTerminals').value.trim().split(' ');
    const terminals = document.getElementById('terminals').value.trim().split(' ');

    const grammar = new Grammar();

    try {
      nonTerminals.forEach(nt => grammar.addNonTerminal(nt));
      terminals.forEach(t => grammar.addTerminal(t));
      grammar.setStartSymbol(startSymbol);
      grammar.setLen(minLen, maxLen);

      rules.forEach(rule => {
        const [nonTerminal, productions] = rule.split('->');
        const productionList = productions.split('|').map(p => p.trim());
        grammar.addRule(nonTerminal.trim(), productionList);
      });

      const chains = grammar.generateAllChains();
      console.log(chains);
      const select = document.getElementById('chain-select');
      select.innerHTML = '';
      chains.forEach(chain => {
        const option = document.createElement('option');
        option.value = chain;
        option.textContent = chain;
        select.appendChild(option);
      });

      select.style.display = 'block';
      document.getElementById('build-tree').style.display = 'block';
    } catch (error) {
      if (error instanceof GrammarError) {
        document.getElementById('result').textContent = `Error: ${error.message}`;
      } else {
        console.error('Unexpected Error:', error);
      }
    }
  });

  document.getElementById('build-tree').addEventListener('click', () => {
    const selectedChain = document.getElementById('chain-select').value;
    // Логика для построения дерева на основе выбранной цепочки
    document.getElementById('result').textContent = `Selected Chain: ${selectedChain}`;
  });
</script>
</body>
</html>
