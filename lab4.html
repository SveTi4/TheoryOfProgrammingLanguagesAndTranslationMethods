<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DPDA Chain Translator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <h1>DPDA Chain Translator</h1>
    <form id="dpdaForm">
        <label for="chain">Chain:</label>
        <input type="text" id="chain" value="aaccc" placeholder="Enter chain" required>
        <br>
        <label for="startState">Start State:</label>
        <input type="text" id="startState" value="q0" placeholder="Enter start state" required>
        <br>
        <label for="finalState">Final State:</label>
        <input type="text" id="finalState" value="qf" placeholder="Enter final state" required>
        <br>
        <label for="terminals">Terminal Symbols:</label>
        <input type="text" id="terminals" value="a,b,c" placeholder="Enter terminal symbols" required>
        <br>
        <label for="nonTerminals">Non-Terminal Symbols:</label>
        <input type="text" id="nonTerminals" value="Z,a" placeholder="Enter non-terminal symbols" required>
        <br>
        <label for="transitions">Transition Rules:</label>
        <input type="text" id="transitions"
               value="q0,a,Z=q1,nop,0; q1,a,Z=q2,push(aZ),0; q1,a,a=q2,push(aa),0; q2,a,a=q1,nop,0; q2,b,a=q2,nop,L; q2,c,a=q4,nop,L; q4,c,a=q5,nop,L; q5,c,a=q4,pop,11; q4,L,Z=qf,nop,L"
               placeholder="Enter transitions" required>
        <br>
        <label for="initialStackSymbol">Initial Stack Symbol:</label>
        <input type="text" id="initialStackSymbol" value="Z" placeholder="Enter initial stack symbol" required>
        <br>
        <div class="main-btns">
            <button type="button" class="btn" onclick="translateChain()">Translate</button>
            <button type="button" class="btn" onclick="clearForm()">Clear</button>
        </div>
    </form>
    <br><br>
    <div class="output" id="output" style="display: none"></div>
</div>

<script>
  function translateChain() {
    const output = document.getElementById('output');
    output.innerHTML = ''; // Clear previous output

    const chain = document.getElementById('chain').value.trim();
    const startState = document.getElementById('startState').value.trim();
    const finalState = document.getElementById('finalState').value.trim();
    const terminals = new Set(document.getElementById('terminals').value.split(',').map(s => s.trim()));
    const nonTerminals = new Set(document.getElementById('nonTerminals').value.split(',').map(s => s.trim()));
    const transitionsInput = document.getElementById('transitions').value.split(';').map(s => s.trim());
    const initialStackSymbol = document.getElementById('initialStackSymbol').value.trim();

    const dpda = {};
    transitionsInput.forEach(rule => {
      const [fromPart, toPart] = rule.split('=').map(s => s.trim());
      const [state, symbol, stackTop] = fromPart.split(',').map(s => s.trim());
      const [newState, stackAction, outputSymbol] = toPart.split(',').map(s => s.trim());

      if (!dpda[state]) dpda[state] = {};
      if (!dpda[state][symbol]) dpda[state][symbol] = {};
      dpda[state][symbol][stackTop] = { newState, stackAction, outputSymbol };
    });

    let stack = [initialStackSymbol];
    let currentState = startState;
    let result = '';

    appendOutput(`Start State: ${currentState}, Initial Stack: ${stack.join('')}`);

    for (let i = 0; i <= chain.length;) {
      const symbol = i < chain.length ? chain[i] : 'L';
      appendOutput(`Symbol: ${symbol} -> Current State: ${currentState}, Stack: ${stack.join('')}`);

      const stackTop = stack.length > 0 ? stack[stack.length - 1] : undefined;
      const transition = dpda[currentState]?.[symbol]?.[stackTop];

      if (!transition) {
        appendOutput(`Error: No transition exists for symbol '${symbol}' with stack top '${stackTop}'`);
        return;
      }

      currentState = transition.newState;
      result += transition.outputSymbol;

      performStackAction(transition.stackAction, stack, appendOutput, currentState);

      if (symbol !== 'L') i++;
    }

    if (currentState === finalState && stack.length === 0) {
      appendOutput(`Final State: ${currentState}, Stack: ${stack.join('')}`);
      appendOutput(`Output Chain: ${result}`);
    } else {
      appendOutput(`Error: Machine did not reach final state or stack is not empty`);
    }
  }

  function performStackAction(stackAction, stack, appendOutput, currentState) {
    if (stackAction.startsWith('push')) {
      const symbols = stackAction.slice(5, -1);
      stack.pop();
      for (let i = symbols.length - 1; i >= 0; i--) {
        stack.push(symbols[i]);
      }
      appendOutput(`Transition to State: ${currentState}, Action: push(${symbols}), Stack: ${stack.join('')}`);
    } else if (stackAction === 'pop') {
      stack.pop();
      appendOutput(`Transition to State: ${currentState}, Action: pop, Stack: ${stack.join('')}`);
    } else if (stackAction === 'nop') {
      appendOutput(`Transition to State: ${currentState}, Action: nop, Stack: ${stack.join('')}`);
    } else {
      appendOutput(`Error: Unknown stack action '${stackAction}'`);
    }
  }

  function appendOutput(message) {
    const output = document.getElementById('output');
    output.style.display = 'block';
    output.innerHTML += `${message}<br>`;
  }

  function clearForm() {
    document.getElementById('dpdaForm').reset();
    const output = document.getElementById('output');
    output.style.display = 'none';
    output.innerHTML = '';
  }
</script>
</body>
</html>
